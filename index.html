<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>VR Post-Test</title>
  <meta name="description" content="VR Post-Test (jsPsych only)"/>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css">

  <style>
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial; background:#f5f5f5; }
    .wrap { max-width: 920px; margin: 24px auto; padding: 0 16px; }
    header { display:flex; align-items:center; justify-content:space-between; margin-bottom: 16px; }
    header h1 { font-size: 22px; margin: 0; }
    #jspsych-target { min-height: 65vh; background:white; border-radius:12px; box-shadow:0 4px 26px rgba(0,0,0,.12); padding:24px; }
    .precheck { font-size: 12px; color:#666; margin-bottom:12px; }
    .warn { color:#c1272d; font-weight:600; }
    .controls { display:flex; gap:10px; align-items:center; margin: 12px 0 28px; flex-wrap: wrap; }
    input[type="text"] { padding:8px 10px; border:1px solid #ccc; border-radius:6px; font-size:15px; min-width: 180px; }
    button.start { padding:10px 18px; border-radius:6px; border: none; font-weight:600; cursor:pointer; background:#1976d2; color:white; }
    button.start:disabled { opacity:0.4; cursor:not-allowed; }

    details { margin-top:18px; font-size:14px; }
    details summary { cursor:pointer; font-weight:600; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>VR Post-Test</h1>
      <div class="precheck" id="lib-check">Loading libraries…</div>
    </header>

    <div class="controls">
      <label for="pid">Participant ID:</label>
      <input id="pid" type="text" placeholder="e.g., S123"/>
      <button class="start" id="btn-immediate">Start Immediate</button>
      <button class="start" id="btn-delayed">Start Delayed</button>
    </div>

    <div id="jspsych-target"></div>

    <details>
      <summary>Help / Requirements</summary>
      <ul>
        <li>All tasks run with jsPsych’s built-in plugins (no SurveyJS required).</li>
        <li>Image/audio placeholders are included so it runs even without assets.</li>
        <li>Update <code>IMAGE_PATHS</code> and <code>AUDIO_PATHS</code> in <code>posttest.js</code> when you have real files.</li>
      </ul>
    </details>
  </div>

  <!-- jsPsych core + plugins -->
  <script src="https://unpkg.com/jspsych@7.3.4"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-likert@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-initialize-microphone@1.0.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-audio-response@1.0.3"></script>

  <!-- Your post-test script -->
  <script src="posttest.js"></script>

  <script>
    window.addEventListener('load', () => {
      const el = document.getElementById('lib-check');
      const checks = [
        ['initJsPsych', typeof window.initJsPsych === 'function'],
        ['HtmlButton', typeof window.jsPsychHtmlButtonResponse === 'function'],
        ['HtmlKeyboard', typeof window.jsPsychHtmlKeyboardResponse === 'function'],
        ['SurveyText', typeof window.jsPsychSurveyText === 'function'],
        ['SurveyLikert', typeof window.jsPsychSurveyLikert === 'function'],
        ['MicInit', typeof window.jsPsychInitializeMicrophone === 'function'],
        ['HtmlAudioResp', typeof window.jsPsychHtmlAudioResponse === 'function'],
      ];
      const missing = checks.filter(([_, ok]) => !ok).map(([k]) => k);
      if (missing.length) {
        el.innerHTML = 'Missing: <span class="warn">' + missing.join(', ') + '</span>';
      } else {
        el.textContent = '✓ All jsPsych plugins loaded';
        el.style.color = '#2e7d32';
      }

      const getPid = () => document.getElementById('pid')?.value.trim() || `S_${Date.now()}`;

      document.getElementById('btn-immediate')?.addEventListener('click', () => {
        if (typeof window.__START_POSTTEST !== 'function') {
          alert('posttest.js not loaded yet.');
          return;
        }
        window.__START_POSTTEST(getPid(), false);
      });

      document.getElementById('btn-delayed')?.addEventListener('click', () => {
        if (typeof window.__START_POSTTEST !== 'function') {
          alert('posttest.js not loaded yet.');
          return;
        }
        window.__START_POSTTEST(getPid(), true);
      });
    });
  </script>
</body>
</html>
